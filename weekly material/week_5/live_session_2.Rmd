---
title: 'Live Session #2 - 9/23/2021'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
```

## Importing a file
Import a dataset from the California Safe Cosmetics Program (CSCP) in the California Department of Public Health. 
The primary purpose of the CSCP is to collect information on hazardous and potentially hazardous ingredients in 
cosmetic products sold in California and to make this information available to the public. 

Our goal is to look at data for products that have been reported to contain titanium dioxide since 2015.
Specifically, we are interested in identifying whether or not titanium dioxide has been removed from products, and if 
so, how long after being reported it was removed. Our end goal is to produce a sentence to summarize the # of 
products that have had the chemical removed.

```{r import}
file_path <- "https://data.chhs.ca.gov/dataset/596b5eed-31de-4fd8-a645-249f3f9b19c4/resource/57da6c9a-41a7-44b0-ab8d-815ff2cd5913/download/cscpopendata.csv"

cos_full <- read_csv(
  file_path
)

```

Let's import the file again, but this time only import the following columns and ensure they are the corresponding data types:
* CDPHId - character
* BrandName - character
* PrimaryCategory - character 
* ChemicalName - character
* InitialDateReported - date
* ChemicalDateRemoved - character (will convert later)
```{r custom_import}

cos_subset <- read_csv(
  file_path,
  col_types = cols_only(CDPHId = col_character(), ProductName = col_character(), BrandName = col_character(), PrimaryCategory = col_character(),ChemicalName = col_character(), InitialDateReported = col_date(format="%m/%d/%Y"), ChemicalDateRemoved = col_character()),
)

```

## Quick exploration
* Structure of dataset/table
* Unique chemical names
* Frequency of product type
* Distribution of dates reported
```{r}

#structure of dataset


#Unique chemical names - return list of values


#Frequency of product type - return list of values and frequencies


#Distribution of dates reported



```


## Tidying the table

Create a subset with:
* only records for Titanium dioxide -
  + Note that there two different relevant categories: Titanium dioxide AND Titanium dioxide (airborne, unbound particles of respirable size)
* only the following columns: BrandName, ProductName, ChemicalName, InitialDateReported, ChemicalDateRemoved
* only records with initial report date since 2015

Try this using base R, ideally in one line of code:
```{r tidy_base}


```

Now try using the tidyverse. Once you have created the subset, remove any duplicate lines/rows and sort table to show by most recent date reported.
```{r tidy_dplyr}


```


## Create new columns

* Convert ChemicalDateRemoved from character to date 
* Create a new variable (removed_yn) indicating if the chemical has been removed. If there is no chemical removed date, then we will assume it has not been removed.
* Create a removal category (removal_cat):
  + Removed before reported
  + Removed within 30 days of reporting
  + Removed within year of reporting
  + Not removed
    
```{r new_columns}


```

## Final Summary

Return two vectors: 
1. Vector of all unique products with titanium dioxide (try this using base R)
2. Vector of all unique products that removed Titanium dioxide within 30 days or initial report (try this using tidyverse)

```{r create_vectors}


```

Use the vectors above to store the total # products with titanium dioxide AND # products with titanium dioxide removed 
```{r store_totals}


```

Based on the total #/% of products with titanium dioxide removed, create an autogenerated summary based on the proportion of products with titanium dioxide removed. If >10% products, make the summary positive; otherwise, express disappointment.
```{r summary}



```

